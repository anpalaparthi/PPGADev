
[36m[2023-07-02 23:19:08,276][182784] Environment ant, action_dim=8, obs_dim=87
using cvt archive
no kmeans
[36m[2023-07-02 23:19:12,167][182784] Created Scheduler for cma_maega with an archive learning rate of 0.1, and add mode batch, using solution dim 28816 and archive dims [7, 7, 7, 7]. Min threshold is -500.0. Restart rule is no_improvement
self.next_obs
torch.Size([3000, 87])
tensor([[0.5322, 1.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
        [0.5405, 1.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
        [0.5269, 1.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
        ...,
        [0.5317, 1.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
        [0.5375, 1.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
        [0.5420, 1.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000]],
       device='cuda:0')
normalize
torch.Size([3000, 87])
step =  0
x.shape
torch.Size([3000, 87])
self.weight
torch.Size([5, 128, 87])
obs per weight
600
x.shape
torch.Size([3000, 128])
self.weight
torch.Size([5, 128, 128])
obs per weight
600
x.shape
torch.Size([3000, 128])
self.weight
torch.Size([5, 8, 128])
obs per weight
600
Traceback (most recent call last):
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home/icaros/Documents/PPGADev/algorithm/train_ppga.py", line 582, in <module>
    train_ppga(cfg, vec_env)
  File "/home/icaros/Documents/PPGADev/algorithm/train_ppga.py", line 398, in train_ppga
    objs, measures, jacobian, metadata = ppo.train(vec_env=vec_env,
  File "/home/icaros/Documents/PPGADev/RL/ppo.py", line 344, in train
    self.next_obs, reward, dones, infos = vec_env.step(action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/to_torch.py", line 59, in step
    obs, reward, done, info = super().step(action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/gym/core.py", line 280, in step
    return self.env.step(action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/gym/wrappers/order_enforcing.py", line 13, in step
    observation, reward, done, info = self.env.step(action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/wrappers.py", line 323, in step
    self._state, obs, reward, done, info = self._step(self._state, action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/api.py", line 622, in cache_miss
    execute = dispatch._xla_call_impl_lazy(fun_, *tracers, **params)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/dispatch.py", line 236, in _xla_call_impl_lazy
    return xla_callable(fun, device, backend, name, donated_invars, keep_unused,
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 303, in memoized_fun
    ans = call(fun, *args)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/dispatch.py", line 359, in _xla_callable_uncached
    return lower_xla_callable(fun, device, backend, name, donated_invars, False,
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/profiler.py", line 314, in wrapper
    return func(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/dispatch.py", line 445, in lower_xla_callable
    jaxpr, out_type, consts = pe.trace_to_jaxpr_final2(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/profiler.py", line 314, in wrapper
    return func(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 2077, in trace_to_jaxpr_final2
    jaxpr, out_type, consts = trace_to_subjaxpr_dynamic2(fun, main, debug_info)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 2027, in trace_to_subjaxpr_dynamic2
    ans = fun.call_wrapped(*in_tracers_)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 167, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/wrappers.py", line 312, in step
    state = self._env.step(state, action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/wrappers.py", line 138, in step
    state = self.env.step(state, action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/wrappers.py", line 70, in step
    return jp.vmap(self.env.step)(state, action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/api.py", line 1682, in vmap_f
    out_flat = batching.batch(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 167, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/wrappers.py", line 110, in step
    state, rewards = jp.scan(f, state, (), self.action_repeat)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/jumpy.py", line 107, in scan
    return jax.lax.scan(f, init, xs, length, reverse, unroll)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/loops.py", line 259, in scan
    init_flat, carry_avals, carry_avals_out, init_tree, *rest = _create_jaxpr(init)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/loops.py", line 245, in _create_jaxpr
    jaxpr, consts, out_tree = _initial_style_jaxpr(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/common.py", line 60, in _initial_style_jaxpr
    jaxpr, consts, out_tree = _initial_style_open_jaxpr(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/common.py", line 54, in _initial_style_open_jaxpr
    jaxpr, _, consts = pe.trace_to_jaxpr_dynamic(wrapped_fun, in_avals, debug)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/profiler.py", line 314, in wrapper
    return func(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 1981, in trace_to_jaxpr_dynamic
    jaxpr, out_avals, consts = trace_to_subjaxpr_dynamic(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 1998, in trace_to_subjaxpr_dynamic
    ans = fun.call_wrapped(*in_tracers_)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 167, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/wrappers.py", line 107, in f
    nstate = self.env.step(state, action)
  File "/home/icaros/Documents/PPGADev/envs/brax_custom/custom_wrappers/clip_wrappers.py", line 18, in step
    nstate = self.env.step(state, action)
  File "/home/icaros/Documents/PPGADev/envs/brax_custom/custom_wrappers/locomotion_wrappers.py", line 133, in step
    state = self.env.step(state, action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/ant.py", line 224, in step
    qp, info = self.sys.step(state.qp, action)
  File "/home/icaros/Documents/PPGADev/envs/brax_custom/custom_wrappers/locomotion_wrappers.py", line 42, in step
    qp, info = super().step(qp, act)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/physics/system.py", line 247, in step
    return step_funs[self.config.dynamics_mode](qp, act)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/physics/system.py", line 376, in _spring_step
    (qp, info), _ = jp.scan(substep, (qp, info), (), self.config.substeps)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/jumpy.py", line 107, in scan
    return jax.lax.scan(f, init, xs, length, reverse, unroll)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/loops.py", line 259, in scan
    init_flat, carry_avals, carry_avals_out, init_tree, *rest = _create_jaxpr(init)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/loops.py", line 245, in _create_jaxpr
    jaxpr, consts, out_tree = _initial_style_jaxpr(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/common.py", line 60, in _initial_style_jaxpr
    jaxpr, consts, out_tree = _initial_style_open_jaxpr(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/common.py", line 54, in _initial_style_open_jaxpr
    jaxpr, _, consts = pe.trace_to_jaxpr_dynamic(wrapped_fun, in_avals, debug)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/profiler.py", line 314, in wrapper
    return func(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 1981, in trace_to_jaxpr_dynamic
    jaxpr, out_avals, consts = trace_to_subjaxpr_dynamic(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 1998, in trace_to_subjaxpr_dynamic
    ans = fun.call_wrapped(*in_tracers_)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 167, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/physics/system.py", line 362, in substep
    collider_data = [c.apply(qp) for c in self.colliders]
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/physics/system.py", line 362, in <listcomp>
    collider_data = [c.apply(qp) for c in self.colliders]
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/physics/colliders.py", line 128, in apply
    contact = jp.vmap(self.contact_fn)(col_a, col_b, qp_a, qp_b)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/api.py", line 1682, in vmap_f
    out_flat = batching.batch(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 167, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/physics/colliders.py", line 757, in capsule_plane
    pos, vel, normal, penetration = sphere_plane(cap.end)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/api.py", line 1682, in vmap_f
    out_flat = batching.batch(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 167, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/physics/colliders.py", line 753, in sphere_plane
    vel = qp_a.vel + jp.cross(qp_a.ang, pos - qp_a.pos)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 601, in __add__
    def __add__(self, other): return self.aval._add(self, other)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/numpy/lax_numpy.py", line 4936, in deferring_binary_op
    return binary_op(*args)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/api.py", line 626, in cache_miss
    top_trace.process_call(primitive, fun_, tracers, params))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/batching.py", line 377, in process_call
    vals_out = call_primitive.bind(f_, *segment_lens, *vals, **params)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 2019, in bind
    outs = top_trace.process_call(self, fun_, tracers, params)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/batching.py", line 377, in process_call
    vals_out = call_primitive.bind(f_, *segment_lens, *vals, **params)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 2019, in bind
    outs = top_trace.process_call(self, fun_, tracers, params)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 1739, in process_call
    jaxpr, out_type, consts = trace_to_subjaxpr_dynamic2(f, self.main, debug_info=dbg)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 2027, in trace_to_subjaxpr_dynamic2
    ans = fun.call_wrapped(*in_tracers_)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 167, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/numpy/ufuncs.py", line 97, in fn
    x1, x2 = _promote_args(numpy_fn.__name__, x1, x2)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/numpy/util.py", line 365, in _promote_args
    return _promote_shapes(fun_name, *_promote_dtypes(*args))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/numpy/util.py", line 286, in _promote_dtypes
    return [lax_internal._convert_element_type(x, to_dtype, weak_type) for x in args]
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/numpy/util.py", line 286, in <listcomp>
    return [lax_internal._convert_element_type(x, to_dtype, weak_type) for x in args]
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/lax.py", line 570, in _convert_element_type
    old_weak_type = dtypes.is_weakly_typed(operand)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/dtypes.py", line 437, in is_weakly_typed
    return x.aval.weak_type
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/batching.py", line 272, in aval
    return core.mapped_aval(aval.shape[self.batch_dim], self.batch_dim, aval)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 2196, in mapped_aval
    return handler(size, axis, aval)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 2214, in _map_shaped_array
    return ShapedArray(tuple_delete(aval.shape, axis), aval.dtype,
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 1375, in __init__
    self.shape = canonicalize_shape(shape)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 1896, in canonicalize_shape
    return tuple(unsafe_map(_canonicalize_dimension, shape))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 1878, in _canonicalize_dimension
    elif (config.jax_dynamic_shapes and isinstance(dim, DArray) and
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/config.py", line 245, in get_state
    val = getattr(_thread_local_state, name, unset)
KeyboardInterrupt
Traceback (most recent call last):
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/runpy.py", line 197, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home/icaros/Documents/PPGADev/algorithm/train_ppga.py", line 582, in <module>
    train_ppga(cfg, vec_env)
  File "/home/icaros/Documents/PPGADev/algorithm/train_ppga.py", line 398, in train_ppga
    objs, measures, jacobian, metadata = ppo.train(vec_env=vec_env,
  File "/home/icaros/Documents/PPGADev/RL/ppo.py", line 344, in train
    self.next_obs, reward, dones, infos = vec_env.step(action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/to_torch.py", line 59, in step
    obs, reward, done, info = super().step(action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/gym/core.py", line 280, in step
    return self.env.step(action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/gym/wrappers/order_enforcing.py", line 13, in step
    observation, reward, done, info = self.env.step(action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/wrappers.py", line 323, in step
    self._state, obs, reward, done, info = self._step(self._state, action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/api.py", line 622, in cache_miss
    execute = dispatch._xla_call_impl_lazy(fun_, *tracers, **params)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/dispatch.py", line 236, in _xla_call_impl_lazy
    return xla_callable(fun, device, backend, name, donated_invars, keep_unused,
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 303, in memoized_fun
    ans = call(fun, *args)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/dispatch.py", line 359, in _xla_callable_uncached
    return lower_xla_callable(fun, device, backend, name, donated_invars, False,
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/profiler.py", line 314, in wrapper
    return func(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/dispatch.py", line 445, in lower_xla_callable
    jaxpr, out_type, consts = pe.trace_to_jaxpr_final2(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/profiler.py", line 314, in wrapper
    return func(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 2077, in trace_to_jaxpr_final2
    jaxpr, out_type, consts = trace_to_subjaxpr_dynamic2(fun, main, debug_info)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 2027, in trace_to_subjaxpr_dynamic2
    ans = fun.call_wrapped(*in_tracers_)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 167, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/wrappers.py", line 312, in step
    state = self._env.step(state, action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/wrappers.py", line 138, in step
    state = self.env.step(state, action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/wrappers.py", line 70, in step
    return jp.vmap(self.env.step)(state, action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/api.py", line 1682, in vmap_f
    out_flat = batching.batch(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 167, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/wrappers.py", line 110, in step
    state, rewards = jp.scan(f, state, (), self.action_repeat)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/jumpy.py", line 107, in scan
    return jax.lax.scan(f, init, xs, length, reverse, unroll)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/loops.py", line 259, in scan
    init_flat, carry_avals, carry_avals_out, init_tree, *rest = _create_jaxpr(init)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/loops.py", line 245, in _create_jaxpr
    jaxpr, consts, out_tree = _initial_style_jaxpr(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/common.py", line 60, in _initial_style_jaxpr
    jaxpr, consts, out_tree = _initial_style_open_jaxpr(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/common.py", line 54, in _initial_style_open_jaxpr
    jaxpr, _, consts = pe.trace_to_jaxpr_dynamic(wrapped_fun, in_avals, debug)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/profiler.py", line 314, in wrapper
    return func(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 1981, in trace_to_jaxpr_dynamic
    jaxpr, out_avals, consts = trace_to_subjaxpr_dynamic(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 1998, in trace_to_subjaxpr_dynamic
    ans = fun.call_wrapped(*in_tracers_)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 167, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/wrappers.py", line 107, in f
    nstate = self.env.step(state, action)
  File "/home/icaros/Documents/PPGADev/envs/brax_custom/custom_wrappers/clip_wrappers.py", line 18, in step
    nstate = self.env.step(state, action)
  File "/home/icaros/Documents/PPGADev/envs/brax_custom/custom_wrappers/locomotion_wrappers.py", line 133, in step
    state = self.env.step(state, action)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/envs/ant.py", line 224, in step
    qp, info = self.sys.step(state.qp, action)
  File "/home/icaros/Documents/PPGADev/envs/brax_custom/custom_wrappers/locomotion_wrappers.py", line 42, in step
    qp, info = super().step(qp, act)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/physics/system.py", line 247, in step
    return step_funs[self.config.dynamics_mode](qp, act)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/physics/system.py", line 376, in _spring_step
    (qp, info), _ = jp.scan(substep, (qp, info), (), self.config.substeps)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/jumpy.py", line 107, in scan
    return jax.lax.scan(f, init, xs, length, reverse, unroll)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/loops.py", line 259, in scan
    init_flat, carry_avals, carry_avals_out, init_tree, *rest = _create_jaxpr(init)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/loops.py", line 245, in _create_jaxpr
    jaxpr, consts, out_tree = _initial_style_jaxpr(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/common.py", line 60, in _initial_style_jaxpr
    jaxpr, consts, out_tree = _initial_style_open_jaxpr(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/control_flow/common.py", line 54, in _initial_style_open_jaxpr
    jaxpr, _, consts = pe.trace_to_jaxpr_dynamic(wrapped_fun, in_avals, debug)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/profiler.py", line 314, in wrapper
    return func(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 1981, in trace_to_jaxpr_dynamic
    jaxpr, out_avals, consts = trace_to_subjaxpr_dynamic(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 1998, in trace_to_subjaxpr_dynamic
    ans = fun.call_wrapped(*in_tracers_)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 167, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/physics/system.py", line 362, in substep
    collider_data = [c.apply(qp) for c in self.colliders]
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/physics/system.py", line 362, in <listcomp>
    collider_data = [c.apply(qp) for c in self.colliders]
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/physics/colliders.py", line 128, in apply
    contact = jp.vmap(self.contact_fn)(col_a, col_b, qp_a, qp_b)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/api.py", line 1682, in vmap_f
    out_flat = batching.batch(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 167, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/physics/colliders.py", line 757, in capsule_plane
    pos, vel, normal, penetration = sphere_plane(cap.end)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/api.py", line 1682, in vmap_f
    out_flat = batching.batch(
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 167, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/brax/physics/colliders.py", line 753, in sphere_plane
    vel = qp_a.vel + jp.cross(qp_a.ang, pos - qp_a.pos)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 601, in __add__
    def __add__(self, other): return self.aval._add(self, other)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/numpy/lax_numpy.py", line 4936, in deferring_binary_op
    return binary_op(*args)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/api.py", line 626, in cache_miss
    top_trace.process_call(primitive, fun_, tracers, params))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/batching.py", line 377, in process_call
    vals_out = call_primitive.bind(f_, *segment_lens, *vals, **params)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 2019, in bind
    outs = top_trace.process_call(self, fun_, tracers, params)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/batching.py", line 377, in process_call
    vals_out = call_primitive.bind(f_, *segment_lens, *vals, **params)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 2019, in bind
    outs = top_trace.process_call(self, fun_, tracers, params)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 1739, in process_call
    jaxpr, out_type, consts = trace_to_subjaxpr_dynamic2(f, self.main, debug_info=dbg)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 2027, in trace_to_subjaxpr_dynamic2
    ans = fun.call_wrapped(*in_tracers_)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/linear_util.py", line 167, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/numpy/ufuncs.py", line 97, in fn
    x1, x2 = _promote_args(numpy_fn.__name__, x1, x2)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/numpy/util.py", line 365, in _promote_args
    return _promote_shapes(fun_name, *_promote_dtypes(*args))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/numpy/util.py", line 286, in _promote_dtypes
    return [lax_internal._convert_element_type(x, to_dtype, weak_type) for x in args]
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/numpy/util.py", line 286, in <listcomp>
    return [lax_internal._convert_element_type(x, to_dtype, weak_type) for x in args]
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/lax/lax.py", line 570, in _convert_element_type
    old_weak_type = dtypes.is_weakly_typed(operand)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/dtypes.py", line 437, in is_weakly_typed
    return x.aval.weak_type
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/interpreters/batching.py", line 272, in aval
    return core.mapped_aval(aval.shape[self.batch_dim], self.batch_dim, aval)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 2196, in mapped_aval
    return handler(size, axis, aval)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 2214, in _map_shaped_array
    return ShapedArray(tuple_delete(aval.shape, axis), aval.dtype,
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 1375, in __init__
    self.shape = canonicalize_shape(shape)
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 1896, in canonicalize_shape
    return tuple(unsafe_map(_canonicalize_dimension, shape))
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/core.py", line 1878, in _canonicalize_dimension
    elif (config.jax_dynamic_shapes and isinstance(dim, DArray) and
  File "/home/icaros/anaconda3/envs/ppga/lib/python3.9/site-packages/jax/_src/config.py", line 245, in get_state
    val = getattr(_thread_local_state, name, unset)
KeyboardInterrupt
step =  1
x.shape
torch.Size([3000, 87])
self.weight
torch.Size([5, 128, 87])
obs per weight
600
x.shape
torch.Size([3000, 128])
self.weight
torch.Size([5, 128, 128])
obs per weight
600
x.shape
torch.Size([3000, 128])
self.weight
torch.Size([5, 8, 128])
obs per weight
600